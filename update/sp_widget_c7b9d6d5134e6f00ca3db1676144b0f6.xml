<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($rootScope, $scope, $location,$sce, $timeout) {
	/* widget controller */
	var c = this;

	
	c.params = $location.search();

	c.only_user = true;

	$scope.hero = {
		img : c.data.site_content[0].hero_image.display_value,
		title : c.data.site_content[0].hero_header.display_value,
		copy : c.data.site_content[0].hero_copy.display_value
	};

	$scope.siteContent =  $rootScope.site_content;

	c.$onInit = function(){
		$timeout(function(){
			if($rootScope.feedbackExists){
				$rootScope.$broadcast('feedbackExists');
			}
			if(c.params.section==2 && !c.data.requests){
				c.getRequests();
			}
			if(c.params.section==3 && c.params.sys_id && !c.data.single_req){
				c.getRequest(c.params.sys_id);
			}
		});
	};
	
	
	c.goSection = function(section){
		$location.url("/" + c.data.portal.url_suffix + "?id=" + c.data.sp_page + '&section=' + section);
	}
	c.goViewItem = function(sysID){
		$location.url("/" + c.data.portal.url_suffix + "?id=" + c.data.sp_page + '&section=3&sys_id=' + sysID);
	}
	
	c.checkBool = function(val){
		var rtn;

		if(typeof val == 'string'){
			rtn = (val.toLowerCase() === 'true');
		}else if(typeof val === 'boolean' ){
			rtn = val;
		}

		return rtn;
	};
	
	c.openCommunity = function(){
		//ga('send', 'event', "Community", "Open");
		//$location.url('?id=pip_community');
		window.open('/community?id=community_forum&sys_id=412dd77e139017002ea1b2566144b09c');
	};
	c.openLogin = function(){
		$location.url('?id=pip_login');
	};
	c.openAskQuestion = function() {
		$rootScope.$broadcast('openAskQuestion', '');
		//ga('send', 'event', "Ask Question", "Open");
	};
	c.openRequest = function(){
		c.showRequest = !c.showRequest;
		//$rootScope.$broadcast('openPracticeRequest', '');
		//ga('send', 'event', "Practice Request", "Open");
	};
	
	c.getRequests = function(){
		c.server.get({ action: 'getRequests' }).then(function(response) {
			if (response.data.success) {
				$timeout(function(){
					c.data.requests = response.data.requests;
					c.data.user_has_requests = response.data.user_has_requests;
					c.only_user = response.data.user_has_requests;
				});
			}
		});
	}
	c.getRequest = function(sysID){
		c.server.get({ action: 'getRequest', sys_id : sysID }).then(function(response) {
			if (response.data.success) {
				$timeout(function(){
					c.data.single_req = response.data.single_req;
console.log(c.data.single_req);				
				});
			}
		});
	}
	
	$rootScope.$on('feedbackExists', function() {
		if(!$rootScope.isMobileView){
			c.fbBtnType = 'right';
			c.objBtnStyle = {
				div: {"z-index":"1500", "top":"80%", "background-color":"#81B5A1"},
				button: { "box-shadow": "0 1px 4px 2px rgba(0, 0, 0, 1)" },
				label: { "font-size":"18px" }
			};
		}else{
			c.fbBtnType = 'right';
			c.objBtnStyle = {
				div: {"z-index":"1500", "top":"70%", "background-color":"#81B5A1"},
				button: { "box-shadow": "0 1px 4px 2px rgba(0, 0, 0, 1)" },
				label: { "font-size":"18px" }
			};
		}
		$rootScope.$broadcast('fbStyleButton', c.fbBtnType, c.objBtnStyle);
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>$btn-bg: $brand-primary;
$btn-txt: $white;
$learnmore-text: $brand-primay;
$brand-dark: #1B1464;
$soft-blue: #1D66AE;

$sn-brand-color: #81B5A1;
$bg-color: transparent !default;
$font-color: #4A4A4A !default;
$text-muted: #9B9B9B;

@media screen and (max-width: 1199px) {
    //medium
}
@media screen and (max-width: 991px) {
  //small
}
@media screen and (max-width: 767px) {
  //mobile
}

.si-container{
  min-height: calc( 100vh - 80px);
  height: 100%;
  text-align: center;
  font-family: Century Gothic,CenturyGothic,AppleGothic,sans-serif !important; 
  font-weight: 400;
  
  .div-hero{
    position: relative;
    top: 0;
    height: 150px;
    overflow: hidden;
    width: 100%;
    margin: 0 auto;
    padding: 0;
    border: 0 transparent;
    background: $bg-color;
    background-repeat: no-repeat;
    background-position: bottom;
    background-size: cover;
    background-color: $bg-color;
    @media screen and (max-width: 767px) {
      height: 75px;
    }
  }
  .hero-overlay{
    position: absolute;
    top: 0;
    overflow: hidden;
    width: 100vw;
    margin: 0 auto;
    padding: 0;
    border: 0 transparent;
    z-index: 10;
    .hero-content{
      max-width: 1200px;
      width: 100%;
      position: relative;
      margin: 0 auto;
      
      color: $white;
      text-align: left;
      
      .hero-header-wrap{
        display: flex;
        height: 150px;
        @media screen and (max-width: 767px) {
          height: 75px;
        }
        .hero-header{
          text-align: left;
          font-size: 60px;
          font-weight: 300;
          letter-spacing: -1.25px;
          position: relative;
          display: flex;
          background-color: transparent;
          -webkit-box-pack: justify;
          -moz-box-pack: justify;
          -ms-flex-pack: justify;
          -webkit-box-align: center;
          -webkit-align-items: center;
          -moz-box-align: center;
          -ms-flex-align: center;
          align-items: center;
          
          @media screen and (max-width: 767px) {
            font-size: 30px;
            left: 15px;
          }
        }
      }
    }
  }
  .primary-copy{
    width: 100vw;
    .copy-wrapper{
      max-width: 1200px;
      width: 100%;
      position: relative;
      margin: 0 auto;
      top: 50px;
      text-align: left;
      @media screen and (max-width: 767px) {
        top: 20px;
      }
      .copy-content{
        .copy-question{
          color: $font-color;
          font-size: 32px;
          font-weight: normal;
          letter-spacing: -0.53px;
          padding-bottom: 24px;
          @media screen and (max-width: 767px) {
            font-size: 26px;
            font-weight: 500;
          }
        }
        .copy-text{
          color: $font-color;
          font-size: 18px;
          font-weight: normal;
          letter-spacing: 0;
          line-height: 31px;
        }
        .btn-wrapper{
          display: block;
          width: 290px;
          margin: 0;
          margin-left: 50px;
        }
        .toggle-view{
          color: $text-muted;
          font-size: 14px;
          font-weight: normal;
          letter-spacing: -0.53px;
          position: relative;
          top: -20px;
          left: 3px;
          cursor: pointer;
        }
        .toggle-view-active{
          color: #43727A
        }
        .item-requests{
          margin-top: 45px;
          margin-bottom: unset;
          color: $text-muted;
          .item-number{ font-weight: 600; }
          .item-what{ text-transform: capitalize; }
          .item-by{ text-transform: capitalize; }
          .view-click{ float: right; }
          hr{
            margin-top: 14px;
            margin-bottom: 14px;
            border-top: 2px solid #ffffff;
          }
        }
        .item-request-none{
          display: none;
        }
        .item-request-user{
          display: block;
          color: #43727A
        }
      }
      .requested-items{
        overflow: auto;
        min-height: 300px;
        width: 100%;
        margin-bottom: 60px;
      }
    }
  }
}
.btn-factory{
  width: 290px;
  background: #FFFFFF;
  border: 1px solid #68A1AF;
  padding: 10px 0px;
  margin: 6px auto;
  color: #68A1AF;
  font-size: 18px;
  font-weight: normal;
  text-align: center;
  line-height: 43px;
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>si-factory</id>
        <internal>false</internal>
        <link/>
        <name>SI - Factory</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	data.cat_item = $sp.getCatalogItem('74a076de136d27004b063192e144b00c');
	data.user = gs.getUser().getID();
	data.user_has_requests = false;
	
	//data.cat_widget = $sp.getWidget('yds-sc-catalog-item',data.cat_item);
	//data.cat_widget = $sp.getWidget('widget-sc-cat-item-v2',data.cat_item);
	data.cat_widget = $sp.getWidget('si-factory-cat-item',data.cat_item);

  data.site_content = [];
	var portal =  $sp.getPortalRecord();
	
	data.portal = {
		url_suffix : portal.getDisplayValue('url_suffix')
	}
	
	data.sp_page = $sp.getParameter('id');
	
  var appCopy = new GlideRecord('x_snc_pip_home');
	appCopy.addQuery('heading','Factory');
	appCopy.orderBy('order');
	appCopy.query();
	while (appCopy.next()) {
		var obj = {};
		$sp.getRecordElements(obj, appCopy, 'sys_id,heading,hero_image,hero_header,hero_copy,page_icon,starting_page,community,order');
		
		data.site_content.push(obj);
	}
	
	data.gahj = $sp.getWidget('pip-gahj');
  
	if (input && Object.keys(input).length > 0) {
		if(input.action == 'getRequests'){
			data.requests = [];
			var grReq = new GlideRecord('sc_req_item');
			grReq.addEncodedQuery('active=true^cat_item=74a076de136d27004b063192e144b00c^stateIN-5,1,2^ORDERBYDESCsys_created_on');
			grReq.query();
			while(grReq.next()){
				var obj = {};
				$sp.getRecordElements(obj, grReq, 'sys_id,number,opended_at,opened_by,stage,state,due_date');
				if(!data.user_has_requests){
					data.user_has_requests = (grReq.getValue('opened_by') == data.user);
				}
				obj.need_help ='';
				
				var grVars = new GlideRecord('sc_item_option_mtom');
				grVars.addQuery('request_item.sys_id',grReq.getUniqueValue());
				grVars.query();
				while(grVars.next()){
					var grVar = new GlideRecord('sc_item_option');
					grVar.addQuery('sys_id',grVars.getValue('sc_item_option'));
					grVar.addQuery('item_option_new.sys_id','d21be38b13b567004b063192e144b0f3')
					grVar.query();
					while(grVar.next()){
						obj.need_help = grVar.getDisplayValue('value');
					}
				}
				
				data.requests.push(obj);
			}
			data.success = true;
		}
		if(input.action == 'getRequest'){
			data.single_req = {};
			var grReq = new GlideRecord('sc_req_item');
			grReq.addEncodedQuery('sys_id=' + input.sys_id);
			grReq.query();
			while(grReq.next()){
				$sp.getRecordElements(data.single_req, grReq, 'sys_id,number,opended_at,opened_by,stage,state,due_date');
			  data.single_req.variables = {};
				var grVars = new GlideRecord('sc_item_option_mtom');
				grVars.addQuery('request_item.sys_id',grReq.getUniqueValue());
				grVars.query();
				while(grVars.next()){
					var grVar = new GlideRecord('sc_item_option');
					grVar.addQuery('sys_id',grVars.getValue('sc_item_option'));
					grVar.orderBy('order');
					grVar.query();
					while(grVar.next()){
						var obj = {};
						$sp.getRecordElements(obj, grVar, 'sys_id,order,item_option_new,value');
						data.single_req.variables[obj.item_option_new.value] = obj;
					}
				}
			}
			data.success = true;
		}
	}
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>chris.stoll</sys_created_by>
        <sys_created_on>2018-11-27 13:05:49</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>c7b9d6d5134e6f00ca3db1676144b0f6</sys_id>
        <sys_mod_count>280</sys_mod_count>
        <sys_name>SI - Factory</sys_name>
        <sys_package display_value="SI Factory - Intake" source="x_snc_intake">40e1969e132d27004b063192e144b031</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="SI Factory - Intake">40e1969e132d27004b063192e144b031</sys_scope>
        <sys_update_name>sp_widget_c7b9d6d5134e6f00ca3db1676144b0f6</sys_update_name>
        <sys_updated_by>chris.stoll</sys_updated_by>
        <sys_updated_on>2018-12-10 19:45:57</sys_updated_on>
        <template><![CDATA[<div class='si-container'>
  <div id='divHero' class='div-hero' style='background-image: url({{hero.img}});'></div>
  <div id='heroOverlay' class='hero-overlay'>
    <div class='hero-content'>
      <div class='hero-header-wrap'>
        <div class='hero-header' ng-bind-html="hero.title"></div>
      </div>
    </div>
  </div>
  <div class='primary-copy' ng-if='!c.params.section'>
    <div class='copy-wrapper'>
      <div class='copy-content'>
        <div class='col-md-12'>
          <div class='copy-question'>
            What can we help you with?
          </div>
        </div>
      </div>
      <div class='copy-content'>
        <div class='col-md-5'>
          <div class='copy-text' ng-bind-html="hero.copy"></div>
        </div>
        <div class='col-md-7'>
          <div class='btn-wrapper'>
            <button class='btn-factory' role='button' ng-click='c.goSection(1)'>Make a Request</button>
            <button class='btn-factory' role='button' ng-click='c.goSection(2)'>Track a Request</button>  
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class='primary-copy' ng-if='c.params.section=="1"'>
    <div class='copy-wrapper'>
      <div class='copy-content'>
        <div class='col-md-12'>
          <div class='copy-question'>
            Make a Request
          </div>
        </div>
      </div>
      <div class='copy-content'>
        <div class='col-md-12'>
          <sp-widget widget="c.data.cat_widget"></sp-widget>
        </div>
      </div>
    </div>
  </div>
  <div class='primary-copy' ng-if='c.params.section=="2"'>
    <div class='copy-wrapper'>
      <div class='copy-content'>
        <div class='col-md-12'>
          <div class='copy-question'>
            Request Tracking
          </div>
          <div class='toggle-view' ng-if='c.data.user_has_requests'>
            <span ng-class="{ 'toggle-view-active' : !c.only_user }" ng-click='c.only_user=false'>See All</span> | <span ng-class="{ 'toggle-view-active' : c.only_user }" ng-click='c.only_user=true'>My Requests</span>
          </div>
        </div>
      </div>
      <div class='copy-content requested-items'>
        <div class='col-md-12'>
          <div ng-repeat='item in c.data.requests' class='item-requests' ng-class="{  'item-request-none' : c.only_user, 'item-request-user' : (item.opened_by.value===c.data.user) }">
            <span class='item-number'>{{ item.number.value }}</span>|
            <span class='item-what'>{{ item.need_help }}</span>|
            <span class='item-by'>{{ item.opened_by.display_value }}</span>
            <span class='view-click' ng-if='item.opened_by.value===c.data.user' ng-click='c.goViewItem(item.sys_id.value)'>View</span>
            <hr/>
            <div>
              <sifactorystatus data-sys_id="{{item.sys_id.value}}" 
                data-stage="{{item.stage.value}}" 
                data-state="{{item.state.display_value}}"
                href="siFactoryStatusTemplate"></sifactorystatus>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class='primary-copy' ng-if='c.params.section=="3"'>
    <div class='copy-wrapper'>
      <div class='copy-content'>
        <div class='col-md-12'>
          <div class='copy-question'>
            Your Submitted Request
          </div>
        </div>
      </div>
      <div class='copy-content'>
        <div class='col-md-12'>
          <sifactorystatus data-sys_id="{{c.data.single_req.sys_id.value}}" 
                data-stage="{{c.data.single_req.stage.value}}" 
                data-state="{{c.data.single_req.state.display_value}}"
                href="siFactoryStatusTemplate"></sifactorystatus>
        </div>
      </div>
      <div class='copy-content'>
        <div class='col-md-6'>
          {{c.data.single_req.number.display_value}} | {{c.data.single_req.variables["d21be38b13b567004b063192e144b0f3"].value.display_value}}
        </div>
        <div class='col-md-6'>
          {{c.data.single_req.variables["d503898313e1a7004b063192e144b019"].value.display_value}}
        </div>
      </div>
      <div class='copy-content'>
        <div class='col-md-12'>
          <div class='copy-question'>
            Progress Log
          </div>
        </div>
      </div>
      <div class='copy-content'>
        <div class='col-md-12'>
          Activity Widget
        </div>
      </div>

    </div>
  </div>
</div>
<!--
<div ng-if='$root.headerWidgets.footer'>
  <sp-widget widget="$root.headerWidgets.footer"></sp-widget>
</div>
-->]]></template>
    </sp_widget>
</record_update>
